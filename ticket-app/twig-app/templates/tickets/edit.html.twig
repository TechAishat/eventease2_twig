{% extends 'base.html.twig' %}

{% block title %}Edit Ticket #{{ ticket.id }} - TicketMaster{% endblock %}

{% block body %}
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            {{ include('tickets/_form_complete.html.twig', {
                title: 'Edit Ticket #' ~ ticket.id,
                form_action: path('tickets.update', {id: ticket.id}),
                ticket: ticket,
                statuses: {
                    'open': 'Open',
                    'in_progress': 'In Progress',
                    'closed': 'Closed'
                },
                priorities: {
                    'low': 'Low',
                    'medium': 'Medium',
                    'high': 'High'
                },
                categories: ['Technical', 'Billing', 'Sales', 'General'],
                users: users|default([]),
                is_edit: true,
                is_admin: is_admin|default(false)
            }) }}
        </div>
    </div>
{% endblock %}

{% block styles %}
    {{ parent() }}
    {{ block('styles', 'tickets/_form_complete.html.twig') }}
{% endblock %}

{% block scripts %}
    {{ parent() }}
    {{ block('scripts', 'tickets/_form_complete.html.twig') }}
{% endblock %}

{% block scripts %}
    {{ parent() }}
    {{ block('scripts', 'tickets/_form.html.twig') }}
    
    <script>
        // Additional scripts specific to the edit page can go here
        document.addEventListener('DOMContentLoaded', function() {
            // Example: Show a warning if the ticket is closed
            const statusSelect = document.getElementById('status');
            if (statusSelect && statusSelect.value === 'closed') {
                showToast('This ticket is currently closed. Any changes will reopen it.');
            }
            
            // Add change listener to show warning when status changes to closed
            statusSelect?.addEventListener('change', function() {
                if (this.value === 'closed') {
                    showToast('Setting status to Closed will prevent further updates.');
                }
            });
        });
    </script>
{% endblock %}
